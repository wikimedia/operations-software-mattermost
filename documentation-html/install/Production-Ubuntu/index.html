<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://docs.mattermost.org/install/Production-Ubuntu/index.html">
        <link rel="shortcut icon" href="../../../../favicon.ico">
        

	<title>Production Ubuntu - Mattermost Documentation</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../index.html">Mattermost Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../index.html">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../help/Manage-Members/index.html">Manage Members</a>
</li>

                        
                            
<li >
    <a href="../../help/README/index.html">README</a>
</li>

                        
                            
<li >
    <a href="../../help/Search/index.html">Search</a>
</li>

                        
                            
<li >
    <a href="../../help/Slack-Import/index.html">Slack Import</a>
</li>

                        
                            
<li >
    <a href="../../help/Team-Statistics/index.html">Team Statistics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../developer/API-Web-Service/index.html">API Web Service</a>
</li>

                        
                            
<li >
    <a href="../../developer/API/index.html">API</a>
</li>

                        
                            
<li >
    <a href="../../developer/Code-Contribution-Guidelines/index.html">Code Contribution Guidelines</a>
</li>

                        
                            
<li >
    <a href="../../developer/Setup/index.html">Setup</a>
</li>

                        
                            
<li >
    <a href="../../developer/Style-Guide/index.html">Style Guide</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Tests</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../developer/tests/test-emoticons/index.html">Test emoticons</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Install <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Administration/index.html">Administration</a>
</li>

                        
                            
<li >
    <a href="../Amazon-Elastic-Beanstalk/index.html">Amazon Elastic Beanstalk</a>
</li>

                        
                            
<li >
    <a href="../Configuration-Settings/index.html">Configuration Settings</a>
</li>

                        
                            
<li >
    <a href="../Docker-Single-Container/index.html">Docker Single Container</a>
</li>

                        
                            
<li >
    <a href="../Production-Debian/index.html">Production Debian</a>
</li>

                        
                            
<li class="active">
    <a href="index.html">Production Ubuntu</a>
</li>

                        
                            
<li >
    <a href="../Release-Numbering/index.html">Release Numbering</a>
</li>

                        
                            
<li >
    <a href="../Requirements/index.html">Requirements</a>
</li>

                        
                            
<li >
    <a href="../SMTP-Email-Setup/index.html">SMTP Email Setup</a>
</li>

                        
                            
<li >
    <a href="../Troubleshooting/index.html">Troubleshooting</a>
</li>

                        
                            
<li >
    <a href="../Upgrade-Guide/index.html">Upgrade Guide</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Integrations <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Single Sign On</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../integrations/Single-Sign-On/Gitlab/index.html">Gitlab</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Webhooks</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../integrations/webhooks/Incoming-Webhooks/index.html">Incoming Webhooks</a>
</li>

        
            
<li >
    <a href="../../integrations/webhooks/Outgoing-Webhooks/index.html">Outgoing Webhooks</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Services</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../integrations/services/Gitlab-Integration-Service-for-Mattermost/index.html">Gitlab Integration Service for Mattermost</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Process <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../process/documentation-guidelines/index.html">Documentation guidelines</a>
</li>

                        
                            
<li >
    <a href="../../process/release-process/index.html">Release process</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../usage/Markdown/index.html">Markdown</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../Production-Debian/index.html">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Release-Numbering/index.html">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/mattermost/platform">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#production-installation-on-ubuntu-1404-lts">Production Installation on Ubuntu 14.04 LTS</a></li>
        
            <li><a href="#install-ubuntu-server-x64-1404-lts">Install Ubuntu Server (x64) 14.04 LTS</a></li>
        
            <li><a href="#set-up-database-server">Set up Database Server</a></li>
        
            <li><a href="#set-up-mattermost-server">Set up Mattermost Server</a></li>
        
            <li><a href="#set-up-nginx-server">Set up Nginx Server</a></li>
        
            <li><a href="#finish-mattermost-server-setup">Finish Mattermost Server setup</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="production-installation-on-ubuntu-1404-lts">Production Installation on Ubuntu 14.04 LTS</h1>
<h2 id="install-ubuntu-server-x64-1404-lts">Install Ubuntu Server (x64) 14.04 LTS</h2>
<ol>
<li>Set up 3 machines with Ubuntu 14.04 with 2GB of RAM or more.  The servers will be used for the Load Balancer, Mattermost (this must be x64 to use pre-built binaries), and Database.</li>
<li>Make sure the system is up to date with the most recent security patches.</li>
<li><code>sudo apt-get update</code></li>
<li><code>sudo apt-get upgrade</code></li>
</ol>
<h2 id="set-up-database-server">Set up Database Server</h2>
<ol>
<li>For the purposes of this guide we will assume this server has an IP address of 10.10.10.1</li>
<li>Install PostgreSQL 9.3+ (or MySQL 5.6+)</li>
<li><code>sudo apt-get install postgresql postgresql-contrib</code></li>
<li>PostgreSQL created a user account called <code>postgres</code>.  You will need to log into that account with:</li>
<li><code>sudo -i -u postgres</code></li>
<li>You can get a PostgreSQL prompt by typing:</li>
<li><code>psql</code></li>
<li>Create the Mattermost database by typing:</li>
<li><code>postgres=# CREATE DATABASE mattermost;</code></li>
<li>Create the Mattermost user by typing:</li>
<li><code>postgres=# CREATE USER mmuser WITH PASSWORD 'mmuser_password';</code></li>
<li>Grant the user access to the Mattermost database by typing:</li>
<li><code>postgres=# GRANT ALL PRIVILEGES ON DATABASE mattermost to mmuser;</code></li>
<li>You can exit out of PostgreSQL by typing:</li>
<li><code>postgre=# \q</code></li>
<li>You can exit the postgres account by typing:</li>
<li><code>exit</code></li>
</ol>
<h2 id="set-up-mattermost-server">Set up Mattermost Server</h2>
<ol>
<li>For the purposes of this guide we will assume this server has an IP address of 10.10.10.2</li>
<li>Download the latest Mattermost Server by typing:</li>
<li><code>wget https://github.com/mattermost/platform/releases/download/v1.1.0/mattermost.tar.gz</code></li>
<li>Unzip the Mattermost Server by typing:</li>
<li><code>tar -xvzf mattermost.tar.gz</code></li>
<li>For the sake of making this guide simple we located the files at <code>/home/ubuntu/mattermost</code>. In the future we will give guidance for storing under <code>/opt</code>.</li>
<li>We have also elected to run the Mattermost Server as the <code>ubuntu</code> account for simplicity.  We recommend setting up and running the service under a <code>mattermost</code> user account with limited permissions.</li>
<li>Create the storage directory for files.  We assume you will have attached a large drive for storage of images and files.  For this setup we will assume the directory is located at <code>/mattermost/data</code>.</li>
<li>Create the directory by typing:</li>
<li><code>sudo mkdir -p /mattermost/data</code></li>
<li>Set the ubuntu account as the directory owner by typing:</li>
<li><code>sudo chown -R ubuntu /mattermost</code></li>
<li>Configure Mattermost Server by editing the config.json file at /home/ubuntu/mattermost/config`</li>
<li><code>cd ~/mattermost/config</code></li>
<li>Edit the file by typing:</li>
<li><code>vi config.json</code></li>
<li>replace <code>DriverName": "mysql"</code> with <code>DriverName": "postgres"</code></li>
<li>replace <code>"DataSource": "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"</code> with <code>"DataSource": "postgres://mmuser:mmuser_password@10.10.10.1:5432/mattermost?sslmode=disable&amp;connect_timeout=10"</code></li>
<li>Optionally you may continue to edit configuration settings in <code>config.json</code> or use the System Console described in a later section to finish the configuration.</li>
<li>Test the Mattermost Server</li>
<li><code>cd ~/mattermost/bin</code></li>
<li>Run the Mattermost Server by typing:</li>
<li><code>./platform</code></li>
<li>You should see a console log like <code>Server is listening on :8065</code> letting you know the service is running.</li>
<li>Stop the server for now by typing <code>ctrl-c</code></li>
<li>Setup Mattermost to use the Ubuntu Upstart daemon which handles supervision of the Mattermost process.</li>
<li><code>sudo touch /etc/init/mattermost.conf</code></li>
<li><code>sudo vi /etc/init/mattermost.conf</code></li>
<li>Copy the following lines into <code>/etc/init/mattermost.conf</code></li>
</ol>
<pre><code>start on runlevel [2345]
stop on runlevel [016]
respawn
chdir /home/ubuntu/mattermost
setuid ubuntu
exec bin/platform
</code></pre>

<ul>
<li>You can manage the process by typing:</li>
<li><code>sudo start mattermost</code></li>
<li>Verify the service is running by typing:</li>
<li><code>curl http://10.10.10.2:8065</code></li>
<li>You should see a page titles <em>Mattermost - Signup</em></li>
<li>You can also stop the process by running the command <code>sudo stop mattermost</code>, but we will skip this step for now.</li>
</ul>
<h2 id="set-up-nginx-server">Set up Nginx Server</h2>
<ol>
<li>For the purposes of this guide we will assume this server has an IP address of 10.10.10.3</li>
<li>We use Nginx for proxying request to the Mattermost Server.  The main benefits are:</li>
<li>SSL termination</li>
<li>http to https redirect</li>
<li>Port mapping :80 to :8065</li>
<li>Standard request logs</li>
<li>Install Nginx on Ubuntu with</li>
<li><code>sudo apt-get install nginx</code></li>
<li>Verify Nginx is running</li>
<li><code>curl http://10.10.10.3</code></li>
<li>You should see a <em>Welcome to nginx!</em> page</li>
<li>You can manage Nginx with the following commands</li>
<li><code>sudo service nginx stop</code></li>
<li><code>sudo service nginx start</code></li>
<li><code>sudo service nginx restart</code></li>
<li>Map a FQDN (fully qualified domain name) like <strong>mattermost.example.com</strong> to point to the Nginx server.</li>
<li>Configure Nginx to proxy connections from the internet to the Mattermost Server</li>
<li>Create a configuration for Mattermost</li>
<li><code>sudo touch /etc/nginx/sites-available/mattermost</code></li>
<li>Below is a sample configuration with the minimum settings required to configure Mattermost
 ```
   server {
      server_name mattermost.example.com;
      location / {
          client_max_body_size 50M;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header Host $http_host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_set_header   X-Frame-Options   SAMEORIGIN;
          proxy_pass http://10.10.10.2:8065;
      }
    }</li>
</ol>
<pre><code>  * Remove the existing file with
  * ``` sudo rm /etc/nginx/sites-enabled/default```
  * Link the mattermost config by typing:
  * ```sudo ln -s /etc/nginx/sites-available/mattermost /etc/nginx/sites-enabled/mattermost```
  * Restart Nginx by typing:
  * ``` sudo service nginx restart```
  * Verify you can see Mattermost thru the proxy by typing:
  * ``` curl http://localhost```
  * You should see a page titles *Mattermost - Signup*

## Set up Nginx with SSL (Recommended)
1. You will need a SSL cert from a certificate authority.
2. For simplicity we will generate a test certificate.
  * ``` mkdir ~/cert```
  * ``` cd ~/cert```
  * ``` sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout mattermost.key -out mattermost.crt```
  * Input the following info 
</code></pre>

<pre><code>Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:California
Locality Name (eg, city) []:Palo Alto
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Example LLC
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:mattermost.example.com
Email Address []:admin@mattermost.example.com
</code></pre>
<pre><code>3. Run `openssl dhparam -out dhparam.pem 4096` (it will take some time).
4. Modify the file at `/etc/nginx/sites-available/mattermost` and add the following lines:
</code></pre>

<p>server {
       listen         80;
       server_name    mattermost.example.com;
       return         301 https://$server_name$request_uri;
  }</p>
<p>server {
        listen 443 ssl;
        server_name mattermost.example.com;</p>
<pre><code>    ssl on;
    ssl_certificate /home/ubuntu/cert/mattermost.crt;
    ssl_certificate_key /home/ubuntu/cert/mattermost.key;
    ssl_dhparam /home/ubuntu/cert/dhparam.pem;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
    ssl_prefer_server_ciphers on;

    # add to location / above
    location / {
        gzip off;
        proxy_set_header X-Forwarded-Ssl on;
</code></pre>
<p>```</p>
<h2 id="finish-mattermost-server-setup">Finish Mattermost Server setup</h2>
<ol>
<li>Navigate to https://mattermost.example.com and create a team and user.</li>
<li>The first user in the system is automatically granted the <code>system_admin</code> role, which gives you access to the System Console.</li>
<li>From the <code>town-square</code> channel click the dropdown and choose the <code>System Console</code> option</li>
<li>Update Email Settings.  We recommend using an email sending service.  The example shows how an Amazon SES setup might look (sample credentials shown below are not real).</li>
<li>Set <em>Send Email Notifications</em> to true</li>
<li>Set <em>Require Email Verification</em> to true</li>
<li>Set <em>Feedback Name</em> to <code>No-Reply</code></li>
<li>Set <em>Feedback Email</em> to <code>mattermost@example.com</code></li>
<li>Set <em>SMTP Username</em> to <code>AFIADTOVDKDLGERR</code></li>
<li>Set <em>SMTP Password</em> to <code>DFKJoiweklsjdflkjOIGHLSDFJewiskdjf</code></li>
<li>Set <em>SMTP Server</em> to <code>email-smtp.us-east-1.amazonaws.com</code></li>
<li>Set <em>SMTP Port</em> to <code>465</code></li>
<li>Set <em>Connection Security</em> to <code>TLS</code></li>
<li>Save the Settings</li>
<li>Update File Settings</li>
<li>Change <em>Local Directory Location</em> from <code>./data/</code> to <code>/mattermost/data</code></li>
<li>Update Log Settings.</li>
<li>Set <em>Log to The Console</em> to false  </li>
<li>Update Rate Limit Settings.</li>
<li>Set <em>Vary By Remote Address</em> to false</li>
<li>Set <em>Vary By HTTP Header</em> to X-Real-IP</li>
<li>Feel free to modify other settings.</li>
<li>Restart the Mattermost Service by typing:</li>
<li><code>sudo restart mattermost</code></li>
</ol></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright (c) 2015 Mattermost, Inc. All Rights Reserved.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
